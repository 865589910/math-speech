# 重新生成"行"字的正确读音

## 📅 时间
2025-10-21

## 🎯 问题描述
"行"字的MP3音频文件读音错误，读成了 `xíng`（行走），应该读 `háng`（行列）。

## ✅ 已完成的修复

### 1. 修改了 `生成语音.py`
添加了多音字映射功能，使用 SSML 标记强制正确读音：

```python
# 多音字正确读音映射（使用SSML标记）
POLYPHONE_MAP = {
    '行': 'h ang2',  # 行列的行，读hang不读xing
}
```

### 2. 更新了生成音频的函数
现在会自动检测多音字并使用正确的拼音标记。

## 📝 重新生成步骤

根据你的偏好，**你需要手动执行以下命令**：

### 步骤1：删除旧的音频文件
首先删除错误的"行"字音频文件：

```powershell
# PowerShell命令（在项目目录下执行）
Remove-Item "audio\section1_positions\行.mp3" -Force
```

或者手动删除文件：
```
路径：C:\Users\pilot\Documents\math speech\audio\section1_positions\行.mp3
```

### 步骤2：重新生成音频
运行Python脚本重新生成所有缺失的音频：

```powershell
# 在项目目录下执行
python 生成语音.py
```

### 步骤3：验证
1. 打开 `index.html`
2. 点击"行"字
3. 播放语音
4. 确认读音是 `háng` 而不是 `xíng`

## 🔧 技术细节

### SSML 拼音标记格式
使用 Microsoft SAPI 拼音格式：
- `h ang2` 表示 háng（第二声）
- 空格分隔声母和韵母
- 数字1-5表示声调（1=阴平，2=阳平，3=上声，4=去声，5=轻声）

### Edge TTS 多音字处理
Edge TTS 默认会根据上下文判断多音字，但单个字时容易出错。使用 SSML 可以强制指定正确读音：

```xml
<phoneme alphabet="sapi" ph="h ang2">行</phoneme>
```

## 📊 其他多音字

如果将来发现其他多音字读音错误，可以在 `生成语音.py` 的 `POLYPHONE_MAP` 中添加：

```python
POLYPHONE_MAP = {
    '行': 'h ang2',      # háng 行列
    '数': 'sh u4',       # shù 数字（名词）
    '长': 'ch ang2',     # cháng 长度
    # 添加更多...
}
```

### 常用声调标注参考
- 第一声（阴平）：1
- 第二声（阳平）：2
- 第三声（上声）：3
- 第四声（去声）：4
- 轻声：5 或不标

## ⚠️ 注意事项

1. **删除旧文件很重要**：如果不删除，脚本会跳过已存在的文件
2. **拼音格式要正确**：SAPI格式对空格和数字很敏感
3. **验证很重要**：生成后一定要听一遍确认

## 🎓 扩展知识

### "行"字的读音区分
- **háng**（第二声）：行列、银行、行业
  - 例：第一行、三行四列
- **xíng**（第二声）：行走、行为、可以
  - 例：行人、行走

在数学语境中，"行"专指"横排"，必须读 `háng`。

## ✨ 完成后的效果

重新生成后：
- ✅ "行"字语音正确读 `háng`
- ✅ 其他字词不受影响
- ✅ 音质保持高品质（Edge TTS晓晓音色）

## 🔗 相关文件

- [生成语音.py](./生成语音.py) - 音频生成脚本（已修改）
- [data.js](./data/data.js) - 数据文件（拼音标注已正确）
- [多音字检查报告.md](./多音字检查报告.md) - 完整多音字检查

需要我帮你执行这些命令吗？（根据你的偏好，我知道你倾向于自己执行😊）
